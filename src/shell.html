<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Minesweeper</title>
    <link rel="icon" href="flag.ico">
    <style>
        body {
            margin: 0;
            background-color: #1c2026;
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            object-fit: contain;
            image-rendering: pixelated;
        }
    </style>
</head>

<body>
    <div id="loading">LOADING GAME...</div>
    <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <style>
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: sans-serif;
            font-size: 24px;
            z-index: 10;
        }
    </style>

    <script type='text/javascript'>
        var Module = {
            print: function (text) { console.log(text); },
            printErr: function (text) {
                console.error(text);
                if (text.indexOf('could not create VBO') > -1) {
                    document.getElementById('loading').innerHTML = "ERROR: WebGL 2.0 not supported or canvas error.";
                }
            },
            canvas: (function () {
                var canvas = document.getElementById('canvas');
                return canvas;
            })(),
            onRuntimeInitialized: function () {
                var loading = document.getElementById('loading');
                if (loading) loading.style.display = 'none';
            },
            preRun: [function () {
                try {
                    if (typeof FS !== 'undefined') {
                        FS.mkdir('/persistent');
                        FS.mount(IDBFS, {}, '/persistent');
                        FS.syncfs(true, function (err) {
                            if (err) console.error('IDBFS sync error:', err);
                        });
                    }
                } catch (e) {
                    console.warn('IDBFS skip:', e);
                }
            }]
        };

        window.sync_to_idbfs = function () {
            if (typeof FS !== 'undefined' && FS.syncfs) {
                FS.syncfs(false, function (err) {
                    if (err) console.error('IDBFS sync error:', err);
                });
            }
        };
    </script>
    {{{ SCRIPT }}}
</body>

</html>